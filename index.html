<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI EduBrain | K12 全场景教育智能体</title>
    <link rel="stylesheet" href="/assets/app.css" />
    <link rel="icon" href="/assets/favicon.svg" type="image/svg+xml" />
  </head>

  <body>
    <div id="toast" class="toast" style="display: none">提示</div>

    <div id="role-gate" class="role-gate" style="display: none">
      <div class="role-card">
        <div class="role-head">
          <div class="role-title">选择身份进入工作区</div>
          <div class="role-sub">
            系统将根据身份构建专属工作台，未选择时仅可见公共服务。
          </div>
        </div>

        <div class="role-grid">
          <div class="role-item" onclick="setRole('teacher')">
            <div class="role-tag">学科教学</div>
            <div class="role-icon">👩‍🏫</div>
            <div class="role-name">学科教师</div>
            <div class="role-desc">智能备课 / 作业批改 / 精准教研 / 职称成长</div>
          </div>

          <div class="role-item" onclick="setRole('homeroom')">
            <div class="role-tag">班级管理</div>
            <div class="role-icon">📋</div>
            <div class="role-name">班主任</div>
            <div class="role-desc">家校通知 / 评语生成 / 班级考勤 / 德育管理</div>
          </div>

          <div class="role-item" onclick="setRole('student')">
            <div class="role-tag">自主学习</div>
            <div class="role-icon">🧑‍🎓</div>
            <div class="role-name">学生</div>
            <div class="role-desc">个性化学习 / 错题举一反三 / 兴趣探索</div>
          </div>

          <div class="role-item" onclick="setRole('parent')">
            <div class="role-tag">家校协同</div>
            <div class="role-icon">👪</div>
            <div class="role-name">家长</div>
            <div class="role-desc">成长追踪 / 事务办理 / 亲子辅导支持</div>
          </div>

          <div class="role-item" onclick="setRole('admin')">
            <div class="role-tag">区域治理</div>
            <div class="role-icon">🏛️</div>
            <div class="role-name">教育管理者</div>
            <div class="role-desc">治理驾驶舱 / 资源统筹 / 风险预警</div>
          </div>
        </div>

        <div class="role-foot">
          <button class="btn btn-ghost" onclick="hideRoleGate()">暂不选择（仅浏览门户）</button>
        </div>
      </div>
    </div>

    <aside class="sidebar">
      <div class="logo-area">
        <div class="logo-mark">
          <img src="/assets/digital-human.svg" alt="AI" style="width: 28px; height: 28px" />
        </div>
        <div class="logo-text">
          <div class="logo-title">AI EduBrain</div>
          <div class="logo-sub">K12 全场景智能体</div>
        </div>
        <button class="sidebar-toggle" onclick="toggleSidebar()">☰</button>
      </div>

      <div class="nav-menu">
        <div class="nav-group-label">公共服务</div>
        
        <div class="nav-item active" id="nav-portal" data-view="portal" onclick="switchView('portal', this)">
          <div class="nav-icon">🏫</div>
          AI智能门户
        </div>

        <div class="nav-item" id="nav-agents" data-view="agents" onclick="switchView('agents', this)">
          <div class="nav-icon">🤖</div>
          智能体中心
        </div>

        <div id="workspace-group" style="display:none">
          <div class="nav-group-label" style="margin-top:10px;">专属工作区</div>

          <div class="nav-item" id="nav-teacher" data-view="teacher" onclick="switchView('teacher', this)" style="display:none">
            <div class="nav-icon">👩‍🏫</div>
            教师工作台
          </div>

          <div class="nav-item" id="nav-homeroom" data-view="homeroom" onclick="switchView('homeroom', this)" style="display:none">
            <div class="nav-icon">📋</div>
            班主任工作台
          </div>

          <div class="nav-item" id="nav-student" data-view="student" onclick="switchView('student', this)" style="display:none">
            <div class="nav-icon">🧑‍🎓</div>
            学生学习中心
          </div>

          <div class="nav-item" id="nav-parent" data-view="parent" onclick="switchView('parent', this)" style="display:none">
            <div class="nav-icon">👪</div>
            家长家校协同
          </div>

          <div class="nav-item" id="nav-gov" data-view="gov" onclick="switchView('gov', this)" style="display:none">
            <div class="nav-icon">🧭</div>
            治理驾驶舱
          </div>
          <div class="nav-item" id="nav-kb" data-view="kb" onclick="switchView('kb', this)" style="display:none">
            <div class="nav-icon">📚</div>
            知识库管理
          </div>
        </div>
      </div>

      <div style="padding: 10px 14px 0;">
         <button class="btn btn-primary" style="width:100%;font-size:13px;" onclick="showRoleGate()">
           🔁 切换/选择身份
         </button>
      </div>

      <div class="user-profile">
        <div class="avatar" id="user-avatar">访</div>
        <div class="user-meta">
          <div class="user-name" id="user-name">访客模式</div>
          <div class="user-sub" id="user-sub">未登录</div>
        </div>
      </div>
    </aside>

    <section class="main-content">
      <header class="top-header" id="top-header">
        <div class="breadcrumb">
          AI EduBrain / <span id="page-title">AI智能门户</span>
        </div>
        <div class="sys-status">
          <span class="dot"></span>
          <span>系统正常</span>
        </div>
      </header>

      <div class="view-wrapper">
        
        <div class="view-container active" id="view-portal">
           <div class="portal-hero">
             <div class="portal-left">
               <div class="portal-badge">统一入口 · 游客/家长/师生通用</div>
               <h1>AI 智能门户：校园服务一站式大厅</h1>
               <p class="portal-desc">
                 聚合校园动态、办事指南与知识库问答。无论您是否登录，数字人助手随时待命。
                 <br>点击下方按钮选择身份，解锁深层业务智能体。
               </p>
               <div class="portal-actions">
                 <button class="btn btn-primary" onclick="showRoleGate()">进入专属工作区</button>
                 <button class="btn btn-ghost" onclick="switchView('agents', null)">浏览智能体中心</button>
               </div>
               <div class="portal-card-grid">
                  <div class="portal-card" onclick="portalGo('news')"><div class="pc-title">校园动态</div><div class="pc-sub">通知公告 · 校园新闻</div></div>
                  <div class="portal-card" onclick="portalGo('service')"><div class="pc-title">办事指南</div><div class="pc-sub">入学报名 · 课后服务</div></div>
                  <div class="portal-card" onclick="portalGo('homeSchool')"><div class="pc-title">家校公开</div><div class="pc-sub">食谱公示 · 收费标准</div></div>
                </div>
                <div class="portal-section card" id="portal-section">
                  <div class="section-title">今日推荐</div>
                  <div class="section-list">
                    <div class="section-item">本周食谱公示：营养午餐搭配详情（点击查看）</div>
                    <div class="section-item">流感高发期健康提示：请家长注意防护</div>
                  </div>
                </div>
             </div>
             <div class="portal-right">
               <div class="dh-card card">
                 <div class="dh-head">
                    <div class="dh-avatar">🤖</div>
                    <div class="dh-meta"><div class="dh-title">数字人咨询</div><div class="dh-sub">基于学校私有知识库</div></div>
                 </div>
                 <div class="dh-chat" id="portal-chat">
                    <div class="dh-bubble ai">您好！我是校园智能助手。您可以问我：<br>“下周食谱是什么？”<br>“怎么报名延时服务？”</div>
                 </div>
                 <div class="dh-input">
                    <input id="portal-input" placeholder="输入问题..." />
                    <button class="btn btn-primary" onclick="portalSend()">发送</button>
                 </div>
               </div>
             </div>
           </div>
        </div>

        <div class="view-container" id="view-agents">
           <div class="agents-head"><h1>智能体中心</h1><p>全场景 AI 能力货架</p><div class="agents-tools"><input id="agents-search" class="magic-input" placeholder="搜索智能体..." oninput="renderAgents()"/><div class="agents-tags" id="agents-tags"></div></div></div>
           <div class="agent-grid" id="agents-grid"></div>
        </div>

        <div class="view-container" id="view-teacher">
          <div class="teacher-toolbar">
             <button id="btn-prep" class="btn btn-primary" onclick="setTeacherMode('prep')">📘 智能备课</button>
             <button id="btn-mark" class="btn btn-ghost" onclick="setTeacherMode('mark')">📝 作业批改</button>
             <button id="btn-ana" class="btn btn-ghost" onclick="setTeacherMode('ana')">📊 学情分析</button>
             <button id="btn-research" class="btn btn-ghost" onclick="setTeacherMode('research')">🧪 教研协同</button>
             <button id="btn-growth" class="btn btn-ghost" onclick="setTeacherMode('growth')">🏅 职称成长</button>
          </div>
          <div class="split-layout">
            <div class="panel">
               <div class="panel-title"><span>🧠 教学副驾</span></div>
               <div class="chat-history" id="chat-box-teacher"><div class="msg ai"><div class="msg-bubble">李老师好，我是您的学科教学助手。今天准备备课还是分析学情？</div></div></div>
               <div class="chat-input"><input id="teacher-input" placeholder="输入指令..." /><button class="btn btn-primary" onclick="triggerTeacherMsg()">发送</button></div>
            </div>
            <div class="workspace">
               <div class="workspace-view active" id="prep-view"><div id="lesson-result"></div></div>
               <div class="workspace-view" id="mark-view"><div class="ocr-shell" onclick="runOCR()"><div class="ocr-tip">点击模拟扫描作业</div><div class="paper-mock"><h3>作业样张</h3></div><div class="scan-laser" id="ocr-laser"></div></div></div>
               <div class="workspace-view" id="ana-view"><div class="ana-grid" id="ana-content"></div></div>
               <div class="workspace-view" id="research-view"><div id="research-root"></div></div>
               <div class="workspace-view" id="growth-view"><div id="growth-root"></div></div>
            </div>
          </div>
        </div>

        <div class="view-container" id="view-homeroom">
          <div class="teacher-toolbar">
            <button class="btn btn-primary">📢 班级通知</button>
            <button class="btn btn-ghost" onclick="showToast('已切换：评语生成')">✍️ 评语生成</button>
            <button class="btn btn-ghost" onclick="showToast('已切换：德育考勤')">🛡️ 德育安全</button>
          </div>
          
          <div class="split-layout">
             <div class="panel">
               <div class="panel-title"><span>🤖 班主任助理</span></div>
               <div class="chat-history" id="chat-box-homeroom">
                 <div class="msg ai"><div class="msg-bubble">我是班主任助理。我可以帮您起草通知、分析班级考勤或生成学生评语。</div></div>
               </div>
               <div class="chat-input">
                 <input id="homeroom-input" placeholder="例：写一份防溺水安全通知..." />
                 <button class="btn btn-primary" onclick="triggerHomeroomMsg()">发送</button>
               </div>
             </div>

             <div class="workspace" style="background:#fff; padding:20px; overflow:auto;">
                <div class="ana-card kpi-card" style="margin-bottom:14px; display:flex; justify-content:space-around;">
                   <div style="text-align:center;">
                     <div class="kpi-title">班级人数</div><div class="kpi-value">42</div>
                   </div>
                   <div style="text-align:center;">
                     <div class="kpi-title">今日出勤</div><div class="kpi-value" style="color:#10b981">42</div>
                   </div>
                   <div style="text-align:center;">
                     <div class="kpi-title">待办事项</div><div class="kpi-value" style="color:#f59e0b">3</div>
                   </div>
                </div>

                <div class="section-title">快捷操作</div>
                <div class="portal-card-grid">
                  <div class="portal-card" onclick="hrAction('notice')">
                    <div class="pc-title">📝 生成通知</div>
                    <div class="pc-sub">活动/放假/安全提醒</div>
                  </div>
                  <div class="portal-card" onclick="hrAction('comment')">
                    <div class="pc-title">✍️ 批量评语</div>
                    <div class="pc-sub">期末/周评/个性化</div>
                  </div>
                  <div class="portal-card" onclick="hrAction('talk')">
                    <div class="pc-title">💬 谈话记录</div>
                    <div class="pc-sub">语音转文字归档</div>
                  </div>
                </div>

                <div class="section-title" style="margin-top:20px;">班级动态流</div>
                <div class="feed-item" style="color:#334155">14:00 [S-02] 高航 家长确认了“防溺水回执”</div>
                <div class="feed-item" style="color:#334155">10:30 [体育课] 全班出勤正常</div>
                <div class="feed-item" style="color:#334155">08:10 [早读] 英语老师反馈课堂纪律良好</div>
             </div>
          </div>
        </div>

        <div class="view-container" id="view-student">
           <div class="student-top">
             <div><div class="student-title">学生学习中心</div><div class="student-sub">自主学习 · 答疑 · 成长</div></div>
             <div class="student-top-right"><div class="streak-pill">🔥 连续打卡 12 天</div></div>
           </div>
           <div class="student-tabs">
             <div class="tab-btn active" id="stab-growth" onclick="setStudentTab('growth')">📈 成长档案</div>
             <div class="tab-btn" id="stab-qa" onclick="setStudentTab('qa')">💬 AI 答疑与错题</div>
           </div>
           <div id="student-growth" class="student-page active"></div>
           <div id="student-qa" class="student-page"></div>
        </div>

        <div class="view-container" id="view-parent">
           <div style="max-width:800px; margin:0 auto;">
              <div class="parent-header card" style="padding:16px; display:flex; align-items:center; gap:14px; margin-bottom:16px;">
                 <div class="avatar" style="width:50px;height:50px;background:#f59e0b;">宋</div>
                 <div>
                   <div style="font-weight:900; font-size:16px;">宋扬（孩子）</div>
                   <div style="font-size:12px; color:#64748b;">七年级 · 数学薄弱项需关注</div>
                 </div>
                 <button class="btn btn-ghost btn-sm" style="margin-left:auto">切换孩子</button>
              </div>

              <div class="card-grid" style="grid-template-columns: 1fr 1fr;">
                 <div class="feature-card" onclick="openParentDetail('growth')">
                    <div class="card-emoji">📈</div>
                    <h3>成长报告</h3>
                    <p>查看周度学情与体质数据</p>
                 </div>
                 <div class="feature-card" onclick="openParentDetail('task')">
                    <div class="card-emoji">📝</div>
                    <h3>作业任务</h3>
                    <p>今日作业由 3 项，已完成 2</p>
                 </div>
                 <div class="feature-card" onclick="openParentDetail('service')">
                    <div class="card-emoji">🍲</div>
                    <h3>生活服务</h3>
                    <p>本周午餐食谱 / 延时服务</p>
                 </div>
                 <div class="feature-card" onclick="openParentDetail('msg')">
                    <div class="card-emoji">🔔</div>
                    <h3>家校通知</h3>
                    <p>您有 1 条未读家长会通知</p>
                 </div>
              </div>
              
              <div class="dh-card card" style="margin-top:16px;">
                <div class="dh-head">
                  <div class="dh-avatar">🦉</div>
                  <div class="dh-meta"><div class="dh-title">家庭教育顾问</div><div class="dh-sub">亲子沟通 / 心理辅导 / 升学建议</div></div>
                </div>
                <div class="dh-chat" id="parent-chat" style="height:180px;">
                  <div class="dh-bubble ai">家长您好！孩子最近数学成绩波动，建议多鼓励他的计算细节。您可以问我：“如何引导孩子检查错题？”</div>
                </div>
                <div class="dh-input">
                  <input id="parent-input" placeholder="输入问题..." />
                  <button class="btn btn-primary" onclick="parentSend()">咨询</button>
                </div>
              </div>
           </div>
        </div>

        <div class="view-container gov-container" id="view-gov">
           <div class="gov-overlay"><div><h2>治理驾驶舱</h2><div style="font-size:12px;opacity:0.8">全区态势 · 风险预警</div></div></div>
           <div class="map-stage"><div class="map-grid" id="map-grid"></div></div>
           <div class="live-feed"><div class="feed-title">实时行为流</div><div id="feed-list"></div></div>
        </div>
        
        <div class="view-container" id="view-kb">
           <div class="kb-head"><h1>知识库管理</h1><p>全校私有知识资产沉淀</p></div>
           <div class="kb-grid">
             <div class="card kb-form">
               <div class="section-title">新增条目</div>
               <input id="kb-title" class="magic-input" placeholder="标题..." />
               <textarea id="kb-content" class="kb-textarea" placeholder="内容..."></textarea>
               <div class="kb-row"><button class="btn btn-primary" onclick="kbAdd()">提交</button></div>
             </div>
             <div class="card kb-list"><div id="kb-list"></div></div>
           </div>
        </div>

      </div>
    </section>

    <div id="modal" class="modal" style="display: none">
      <div class="modal-mask" onclick="closeModal()"></div>
      <div class="modal-card">
        <div class="modal-head"><div class="modal-title" id="modal-title"></div><button class="btn btn-ghost" onclick="closeModal()">X</button></div>
        <div class="modal-body" id="modal-body"></div>
      </div>
    </div>

    <script src="/assets/app.js"></script>
  </body>
</html>
